// jQuery geolocation.edit plugin v0.0.11 (2014-06-01)
// Copyright (c) 2012 Milos Popovic <the.elephant@gmail.com>
// Freely distributable under the MIT license.
// see: http://github.com/miloss/jquery-geolocation-edit
(function(a){var h,g,k;h=[];g={main:function(c){var b=this,d,f,e;if("undefined"===typeof c.lat||"undefined"===typeof c.lng)a.error("Please provide 'lat' and 'lng' options for jQuery.geolocate");else if("undefined"===typeof google||"undefined"===typeof google.maps)h.push(function(){a(b).geolocate(c)}),k();else if(d=a.extend(!0,{address:[],changeOnEdit:!1,mapOptions:{zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},markerOptions:{draggable:!0,animation:google.maps.Animation.DROP}, geoCallback:function(){}},c),a(this).data("opts",d),f=parseFloat(a(d.lat).val()),e=parseFloat(a(d.lng).val()),isNaN(f)&&(f=0),isNaN(e)&&(e=0),f=new google.maps.LatLng(f,e),a(this).geolocate({},"initMap",f),d.changeOnEdit&&(a(d.lat).change(function(){}),a(d.lng).change(function(){})),e=d.address.length,0<e)for(f=0;f<e;f++)a(d.address[f]).change(function(){a(b).geolocate({},"callGeocoding")})},initMap:function(c){var b=a(this).get(0),d=google.maps,f,e=a.data(b,"opts");f=new d.Map(b,a.extend({center:c}, e.mapOptions));c=a.extend({map:f,position:c},e.markerOptions);c=new d.Marker(c);a.data(b,"map",f);a.data(b,"marker",c);d.event.addListener(c,"dragend",function(){a(b).geolocate({},"getMarkerLocation")})},callGeocoding:function(){for(var c=a(this).get(0),b=a.data(c,"opts"),d=b.address.length,f=b.geoCallback,e="";d--;)e+=a(b.address[d]).val();(new google.maps.Geocoder).geocode({address:e},function(b,d){var e,g,h,k;f(b,d);g=b[0];"undefined"!==typeof g&&(h=a.data(c,"map"),k=a.data(c,"marker"),e=g.geometry.location, h.panToBounds(g.geometry.viewport),h.panTo(e),k.setPosition(e),a(c).geolocate({},"getMarkerLocation"))})},getMarkerLocation:function(){var c=a(this).get(0),b=a.data(c,"marker"),c=a.data(c,"opts"),b=b.getPosition();a(c.lat).val(b.lat());a(c.lng).val(b.lng())}};a.fn.geolocate=function(c,b){var d=Array.prototype.slice;if("undefined"===typeof b){if("string"===typeof c&&"undefined"!==typeof g[c])return g[c].apply(this,d.call(arguments,1));a(this).geolocate({},"main",c)}else{if(g[b])return g[b].apply(this, d.call(arguments,2));a.error("Method "+b+" does not exist on jQuery.geolocate")}return this};a.fn.geolocateGMapsLoaded=function(){for(;h.length;)h.shift()()};k=function(){var a=!1;return function(){var b;a||(a=!0,b=document.createElement("script"),b.type="text/javascript",b.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=$.fn.geolocateGMapsLoaded",document.body.appendChild(b))}}()})(jQuery);
